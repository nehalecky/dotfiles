-- WezTerm configuration
-- Migrated from iTerm2 settings

local wezterm = require 'wezterm'
local config = wezterm.config_builder()

-- Font configuration
config.font = wezterm.font('MesloLGS NF')
config.font_size = 12.0
config.line_height = 1.0

-- Color scheme (dark theme matching iTerm2 settings)
config.colors = {
  -- Foreground and background
  foreground = '#a0a0a0',  -- ~62.7% gray from iTerm2
  background = '#121212',  -- ~7% gray from iTerm2
  
  -- Cursor colors
  cursor_bg = '#bbbbbb',   -- ~73.3% gray
  cursor_fg = '#ffffff',
  cursor_border = '#bbbbbb',
  
  -- Selection colors
  selection_fg = '#bbbcc0', -- ~71-75% gray blend
  selection_bg = '#453a39', -- ~27% gray with slight warmth
  
  -- ANSI colors (converted from iTerm2)
  ansi = {
    '#1b1d1e',  -- black (Ansi 0)
    '#f92672',  -- red (Ansi 1)
    '#a6e22e',  -- green (Ansi 2)
    '#fd971f',  -- yellow (Ansi 3)
    '#66d9ef',  -- blue (Ansi 4)
    '#9e6ffe',  -- magenta (Ansi 5)
    '#5e7175',  -- cyan (Ansi 6)
    '#ccccc6',  -- white (Ansi 7)
  },
  
  -- Bright ANSI colors
  brights = {
    '#505354',  -- bright black (Ansi 8)
    '#ff669d',  -- bright red (Ansi 9)
    '#beed5f',  -- bright green (Ansi 10)
    '#e6db74',  -- bright yellow (Ansi 11)
    '#66d9ef',  -- bright blue (Ansi 12)
    '#9e6ffe',  -- bright magenta (Ansi 13)
    '#a3babf',  -- bright cyan (Ansi 14)
    '#f8f8f2',  -- bright white (Ansi 15)
  },
}

-- Window configuration
{{- if .is_work }}
-- Larger window for work laptop
config.initial_cols = 120
config.initial_rows = 40
{{- else }}
config.initial_cols = 80
config.initial_rows = 25
{{- end }}
config.window_padding = {
  left = 2,
  right = 2,
  top = 2,
  bottom = 2,
}

-- Features
config.enable_scroll_bar = false
config.scrollback_lines = 1000
config.audible_bell = 'Disabled'  -- iTerm2 had "Silence Bell" = true

-- Tab bar (keeping it minimal like the terminal-first approach)
config.hide_tab_bar_if_only_one_tab = true
config.tab_bar_at_bottom = false
config.use_fancy_tab_bar = false

-- Key bindings to match iTerm2 keyboard map
config.keys = {
  -- Option+Backspace to delete word
  {
    key = 'Backspace',
    mods = 'OPT',
    action = wezterm.action.SendString '\x1b\x7f',
  },
  -- Cmd+Left to move to beginning of line
  {
    key = 'LeftArrow',
    mods = 'CMD',
    action = wezterm.action.SendString '\x01',
  },
  -- Cmd+Right to move to end of line  
  {
    key = 'RightArrow',
    mods = 'CMD',
    action = wezterm.action.SendString '\x05',
  },
  -- Option+Left to move word left
  {
    key = 'LeftArrow',
    mods = 'OPT',
    action = wezterm.action.SendString '\x1bb',
  },
  -- Option+Right to move word right
  {
    key = 'RightArrow',
    mods = 'OPT',
    action = wezterm.action.SendString '\x1bf',
  },
  -- Cmd+Backspace to delete to beginning of line
  {
    key = 'Backspace',
    mods = 'CMD',
    action = wezterm.action.SendString '\x15',
  },
  -- Delete key sends forward delete
  {
    key = 'Delete',
    mods = 'NONE',
    action = wezterm.action.SendString '\x04',
  },
  -- Option+Delete to delete word forward
  {
    key = 'Delete',
    mods = 'OPT',
    action = wezterm.action.SendString '\x1bd',
  },
}

-- Mouse configuration
config.mouse_bindings = {
  -- Right click to paste
  {
    event = { Down = { streak = 1, button = 'Right' } },
    mods = 'NONE',
    action = wezterm.action.PasteFrom 'Clipboard',
  },
}

-- Working directory
config.default_cwd = wezterm.home_dir

-- Performance
config.front_end = 'WebGpu'  -- GPU acceleration
config.max_fps = 120

-- Enable ligatures (iTerm2 had "ASCII Ligatures" = true)
config.harfbuzz_features = { 'calt=1', 'clig=1', 'liga=1' }

-- macOS specific
config.native_macos_fullscreen_mode = true
{{- if .is_work }}
-- Slight transparency for work environment
config.window_background_opacity = 0.98
config.macos_window_background_blur = 10
{{- else }}
config.macos_window_background_blur = 0  -- No blur by default
{{- end }}

-- Hyperlink configuration (iTerm2 had link color configured)
config.hyperlink_rules = wezterm.default_hyperlink_rules()

return config