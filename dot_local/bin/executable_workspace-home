#!/bin/bash
# Home Command Center - Daily operations workspace
# A persistent workspace for dotfiles management, AI assistance, and Jira task management

set -euo pipefail

echo "ğŸ  Launching Home Command Center workspace"
echo "ğŸ“ Working directory: $HOME"

# Start in HOME directory
cd "$HOME"

# Create new WezTerm window (fullscreen via manual Cmd+Enter if desired)
ROOT_PANE=$(wezterm cli spawn --new-window --cwd "$HOME" -- zsh)

# Top weather strip - Rich-formatted enhanced display  
WEATHER_PANE=$(wezterm cli split-pane --pane-id "$ROOT_PANE" --top --cells 3 -- zsh -c "
while true; do
    # Use Rich-based weather display (now with global Rich install)
    ~/.local/bin/weather-display || {
        # Fallback to simple display if weather-display fails
        echo 'âš ï¸ Weather display error, using basic fallback'
        echo 'ğŸ“ \$(curl -s \"wttr.in/?format=%l\" 2>/dev/null | tr -d \'\n\' || echo \"Location unknown\"): \$(curl -s \"wttr.in/?format=%t\" 2>/dev/null || echo \"?Â°C\")'
        echo 'ğŸ”„ Retrying in 5 minutes...'
    }
    
    sleep 300  # Update every 5 minutes
done
")

# Upper right: File manager (yazi) - 50% width of remaining space
FILE_PANE=$(wezterm cli split-pane --pane-id "$ROOT_PANE" --right --percent 50 -- yazi "$HOME")

# Lower left: Claude Code - 50% height of left side, auto-launch
CLAUDE_PANE=$(wezterm cli split-pane --pane-id "$ROOT_PANE" --bottom --percent 50 -- zsh -c "
echo 'ğŸ¤– Launching Claude Code...'
sleep 1
claude
")

# Lower right: Task dashboard - 50% height of right side
# Jira integration and system management commands
TASK_PANE=$(wezterm cli split-pane --pane-id "$FILE_PANE" --bottom --percent 50 -- zsh -c "
echo 'ğŸ“‹ Task Management Center'
echo 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€'
echo ''
echo 'Jira Integration:'
echo '  acli issue list          - List current issues'
echo '  claude jira search       - Search Jira via Claude'
echo '  gh dash                  - GitHub dashboard'
echo ''
echo 'System Management:'
echo '  chezmoi status           - Check dotfile changes'
echo '  chezmoi diff             - Review pending changes'
echo '  brew outdated            - Check for updates'
echo ''
echo 'Workspace Shortcuts (Ctrl+a):'
echo '  W = Launch project workspace'
echo '  h = Return to home workspace'
echo '  r = Refresh workspace'
echo ''
echo 'âœ… TaskWarrior successfully migrated to Jira!'
echo '   All tasks now managed via middledata.atlassian.net'
echo ''
exec zsh
")

# Set window title
wezterm cli set-tab-title --pane-id "$ROOT_PANE" "ğŸ  Home Command Center"

echo "âœ… Home Command Center ready!"
echo ""
echo "Layout:"
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚ Terminal (zsh)  â”‚ Files (yazi)    â”‚"
echo "â”‚ HOME directory  â”‚ File browser    â”‚"
echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
echo "â”‚ Claude Code     â”‚ Jira Tasks      â”‚"
echo "â”‚ AI assistance   â”‚ & System Mgmt   â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "ğŸ’¡ Tips:"
echo "  â€¢ Terminal starts in HOME directory"
echo "  â€¢ Use 'cd ~/.local/share/chezmoi' for dotfiles source"
echo "  â€¢ Use 'chezmoi edit <file>' to modify configs"
echo "  â€¢ Run 'workspace-dev <project>' to launch project workspace"
echo "  â€¢ This workspace is for system management, not project development"