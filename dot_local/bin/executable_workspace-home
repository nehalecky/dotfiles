#!/bin/bash
# Home Command Center - Daily operations workspace
# A persistent workspace for dotfiles management, AI assistance, and task tracking

set -euo pipefail

echo "ğŸ  Launching Home Command Center workspace"
echo "ğŸ“ Working directory: $HOME"

# Start in HOME directory
cd "$HOME"

# Create new WezTerm window
WINDOW_ID=$(wezterm cli spawn --new-window --cwd "$HOME" -- zsh)

# Upper right: File manager (yazi) - 50% width
FILE_PANE=$(wezterm cli split-pane --pane-id "$WINDOW_ID" --right --percent 50 -- yazi "$HOME")

# Lower left: Claude Code - 50% height of left side
CLAUDE_PANE=$(wezterm cli split-pane --pane-id "$WINDOW_ID" --bottom --percent 50 -- zsh -c "echo 'ğŸ¤– Claude Code Ready'; echo 'Run: claude -p \"...\" to start'; exec zsh")

# Lower right: Task dashboard - 50% height of right side
# Launch taskwarrior-tui if available, otherwise show task hints
if command -v taskwarrior-tui >/dev/null 2>&1; then
    TASK_PANE=$(wezterm cli split-pane --pane-id "$FILE_PANE" --bottom --percent 50 -- taskwarrior-tui)
else
    TASK_PANE=$(wezterm cli split-pane --pane-id "$FILE_PANE" --bottom --percent 50 -- zsh -c "
    echo 'ğŸ“‹ Task Management Center'
    echo 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€'
    echo ''
    echo 'Quick Commands:'
    echo '  gh dash          - GitHub dashboard for issues/PRs'
    echo '  chezmoi status   - Check dotfile changes'
    echo '  chezmoi diff     - Review pending changes'
    echo '  brew outdated    - Check for updates'
    echo ''
    echo 'Workspace Shortcuts (Ctrl+a):'
    echo '  W = Launch project workspace'
    echo '  h = Return to home workspace'
    echo ''
    if command -v task >/dev/null 2>&1; then
        echo 'Taskwarrior detected! Commands:'
        echo '  task list        - Show all tasks'
        echo '  task add <desc>  - Add new task'
        echo '  taskwarrior-tui  - Interactive task manager'
        echo ''
        task list 2>/dev/null || true
    fi
    exec zsh
    ")
fi

# Set window title
wezterm cli set-tab-title --pane-id "$WINDOW_ID" "ğŸ  Home Command Center"

echo "âœ… Home Command Center ready!"
echo ""
echo "Layout:"
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚ Terminal (zsh)  â”‚ Files (yazi)    â”‚"
echo "â”‚ HOME directory  â”‚ File browser    â”‚"
echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
echo "â”‚ Claude Code     â”‚ Tasks/Status    â”‚"
echo "â”‚ AI assistance   â”‚ Management      â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "ğŸ’¡ Tips:"
echo "  â€¢ Terminal starts in HOME directory"
echo "  â€¢ Use 'cd ~/.local/share/chezmoi' for dotfiles source"
echo "  â€¢ Use 'chezmoi edit <file>' to modify configs"
echo "  â€¢ Run 'workspace-dev <project>' to launch project workspace"
echo "  â€¢ This workspace is for system management, not project development"